# TCP

## TCP とは
TCP(Transmission Control Protocol)は通信プロトコルの一つで、主にインターネット通信に使用されます。


## ブラウザがWebページを表示するまで
1. ブラウザでURLを入力
2. HTTPのリクエストメッセージを作成
3. URLのドメインをIPアドレスに変換する（名前解決）
   1. SocketライブラリのDNSリゾルバに名前解決を依頼
   2. DNSリゾルバがDNSサーバーに問い合わせメッセージを送信
   3. DNSサーバーからの応答メッセージからIPアドレスを取り出し、アプリケーションに返す
4. アクセス先のWebサーバーにメッセージを送信するようにOSに依頼
   1. Socketライブラリを使用し、OS内部のプロトコル・スタックに命令を実行
      1. ソケットを作る（ソケット作成フェーズ）
         1. Socketライブラリのsocket()命令で通信の窓口となるソケットを作成する
      2. サーバー側のソケットにパイプを繋ぐ（接続フェーズ）
         1. Socketライブラリのconnect()命令を呼び出す
         2. プロトコル・スタックが接続動作を実行
         3. プロトコル・スタックが繋がった相手のIPアドレスやポート番号などの情報をソケットに記録する
      3. データを送受信する（送受信フェーズ）
         1. Socketライブラリのwrite()命令を実行
         2. ソケットと送信データ（HTTPリクエスト）をプロトコル・スタックに指示
         3. プロトコル・スタックがデータを送受信する
            1. 送信データをパケットに分割
            2. プロトコル・スタックのTCP担当部分がTPCヘッダを付与
            3. プロトコル・スタックのIP担当がIPヘッダとMACヘッダを付与
            4. ネットワーク・インタフェースにパケット渡して送受信
      4. パイプを外してソケットを抹消する（切断フェーズ）

## DNSサーバーの動き